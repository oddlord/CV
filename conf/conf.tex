\RequirePackage{bibentry}
\makeatletter\let\saved@bibitem\@bibitem\makeatother

\documentclass[\cvLanguage, a4paper]{europasscv}

\makeatletter\let\@bibitem\saved@bibitem\makeatother

\usepackage{booktabs}
\usepackage{ifthen}

\graphicspath{{img/}}

\newboolean{coursesBool}
\newboolean{projectsBool}
\newboolean{signatureBool}
\newboolean{urlsBool}
\newboolean{publicationsBool}

\newcommand{\ifCourses}[1]{\ifthenelse{\boolean{coursesBool}}{#1}{}}
\newcommand{\ifProjects}[1]{\ifthenelse{\boolean{projectsBool}}{#1}{}}
\newcommand{\ifSignature}[1]{\ifthenelse{\boolean{signatureBool}}{#1}{}}
\newcommand{\ifURLs}[1]{\ifthenelse{\boolean{urlsBool}}{#1}{}}
\newcommand{\ifPublications}[1]{\ifthenelse{\boolean{publicationsBool}}{#1}{}}

\setboolean{coursesBool}{\courses}
\setboolean{projectsBool}{\projects}
\setboolean{signatureBool}{\signature}
\setboolean{urlsBool}{\urls}
\setboolean{publicationsBool}{\publications}

\newcommand{\ifEngIta}[2]{%
  \ifthenelse{\equal{\cvLanguage}{english}}%
  {#1}%
  {%
    \ifthenelse{\equal{\cvLanguage}{italian}}%
    {#2}%
    {ERROR: WRONG LANGUAGE! Supported languages: english, italian}%
  }%
}%

\newcommand{\addSignature}{%
  \ifSignature{%
    \ifEngIta{%
      \null\vspace*{\stretch{1}}%
      \flushright%
      \begin{tabular}{rp{250pt}}%
        & \small My personal details can be processed into your data system.\\%
        & \\%
        & Signature:\\%
        & \\%
        \bottomrule%
      \end{tabular}%
    }{%
      \null\vspace*{\stretch{1}}%
      \flushright%
      \begin{tabular}{rp{250pt}}%
        & \small Autorizzo il trattamento dei dati personali contenuti nel mio curriculum vitae in base art. 13 del \url{http://www.garanteprivacy.it/garante/doc.jsp?ID=1311248}{D. Lgs. 196/2003}.\\%
        & \\%
        & Firma:\\%
        & \\%
        \bottomrule%
      \end{tabular}%
    }%
  }%
}%

\newenvironment{europasscvDocument}{%
  \begin{document}\begin{europasscv}%
}{%
  \end{europasscv}\addSignature\end{document}%
}%

\newcommand{\addName}[1]{\ecvname{#1}}
\newcommand{\addAddress}[2]{\ecvaddress{\ifEngIta{#1}{#2}}}
\newcommand{\addCellTel}[2]{\ecvtelephone[#1]{#2}}
\newcommand{\addEmail}[1]{\ecvemail{#1}}
\newcommand{\addHomepage}[1]{\ecvhomepage{#1}}
\newcommand{\addIM}[2]{\ecvim{#1}{#2}}
\newcommand{\addDateOfBirth}[2]{\ecvdateofbirth{\ifEngIta{#1}{#2}}}
\newcommand{\addNationality}[2]{\ecvnationality{\ifEngIta{#1}{#2}}}
\newcommand{\addGender}[2]{\ecvgender{\ifEngIta{#1}{#2}}}
\newcommand{\addPicture}[1]{\ecvpicture[width=3.8cm]{#1}}

\ifEngIta{
  \newcommand{\jobAppliedForString}{Job applied for}
}{
  \newcommand{\jobAppliedForString}{Impiego ricercato}
}
\newcommand{\addJobAppliedFor}[2]{%
  \ecvbigitem{%
    \jobAppliedForString%
  }{%
    \ifEngIta{#1}{#2}%
  }%
}%

\ifEngIta{
  \newcommand{\workExperienceString}{Work experience}
}{
  \newcommand{\workExperienceString}{Esperienza professionale}
}
\newcommand{\workExperience}{%
  \ecvsection{\workExperienceString}%
}%

\newcommand{\addJob}[4]{%
  \ecvtitle{\ifEngIta{#1}{#3}}{\ifEngIta{#2}{#4}}%
}%

\newcommand{\addItem}[2]{%
  \ecvitem{}{\ifEngIta{#1}{#2}}%
}%

\ifEngIta{
  \newcommand{\educationAndTrainingString}{Education and training}
}{
  \newcommand{\educationAndTrainingString}{Istruzione e formazione}
}
\newcommand{\educationAndTraining}{%
  \ecvsection{\educationAndTrainingString}%
}%

\newcommand{\addSchool}[5]{%
  \ecvtitlelevel{\ifEngIta{#1}{#3}}{\ifEngIta{#2}{#4}}{#5}%
}%

\ifEngIta{
  \newcommand{\coursesString}{Courses}
}{
  \newcommand{\coursesString}{Corsi}
}
\newcommand{\addCourses}[2]{%
  \ifCourses{\ecvitem{\coursesString}{\ifEngIta{#1}{#2}}}%
}%

\newcommand{\addURL}[1]{\ifURLs{ - \url{#1}}}

\ifEngIta{
  \newcommand{\thesisString}{Thesis}
}{
  \newcommand{\thesisString}{Tesi}
}
\newcommand{\addThesis}[2]{%
  \ecvitem{\thesisString}{\ifEngIta{#1}{#2}}%
}%
\newcommand{\addThesisURL}[3]{%
  \ecvitem{\thesisString}{\ifEngIta{#1}{#2}\addURL{#3}}%
}%

\ifEngIta{
  \newcommand{\projectsString}{Projects}
}{
  \newcommand{\projectsString}{Progetti}
}
\newcommand{\addProjects}[1]{%
  \ifProjects{\ecvitem{\projectsString}{\begin{ecvitemize}#1\end{ecvitemize}}}%
}%
\newcommand{\addProject}[3]{%
  \item \textit{#1}: \ifEngIta{#2}{#3}%
}%
\newcommand{\addProjectURL}[4]{%
  \addProject{#1}{#2}{#3}\addURL{#4}%
}%

\ifEngIta{
  \newcommand{\finalRankString}{Final rank}
}{
  \newcommand{\finalRankString}{Voto finale}
}
\newcommand{\addFinalRank}[2]{%
  \ecvitem{\finalRankString}{\ifEngIta{#1}{#2}}%
}%

\ifEngIta{
  \newcommand{\personalSkillsString}{Personal skills}
}{
  \newcommand{\personalSkillsString}{Capacità personali}
}
\newcommand{\personalSkills}{%
  \ecvsection{\personalSkillsString}%
}%

\newcommand{\addLanguage}[7]{%
  \ecvlanguage{\ifEngIta{#1}{#2}}{#3}{#4}{#5}{#6}{#7}
}%
\newcommand{\addLastLanguage}[7]{%
  \ecvlastlanguage{\ifEngIta{#1}{#2}}{#3}{#4}{#5}{#6}{#7}
}%

\newcommand{\addMotherTongue}[2]{%
  \ecvmothertongue{\ifEngIta{#1}{#2}}%
}%
\newcommand{\addOtherLanguages}[1]{%
  \ecvlanguageheader%
  #1%
  \ecvlanguagefooter%
}%

\ifEngIta{
  \newcommand{\communicationSkillsString}{Communication skills}
}{
  \newcommand{\communicationSkillsString}{Capacità di comunicazione}
}
\newcommand{\communicationSkills}[2]{%
  \ecvblueitem{%
    \communicationSkillsString%
  }{%
    \ifEngIta{#1}{#2}%
  }%
}%

\ifEngIta{
  \newcommand{\organisationalSkillsString}{Organisational / managerial skills}
}{
  \newcommand{\organisationalSkillsString}{Capacità organizzative / manageriali}
}
\newcommand{\organisationalSkills}[2]{%
  \ecvblueitem{%
    \organisationalSkillsString%
  }{%
    \ifEngIta{#1}{#2}%
  }%
}%

\newcommand{\addList}[1]{%
  \begin{ecvitemize}%
    #1
  \end{ecvitemize}%
}%
\newcommand{\addListItem}[1]{%
  \item #1
}%

\ifEngIta{
  \newcommand{\computerSkillsString}{Computer skills}
}{
  \newcommand{\computerSkillsString}{Capacità informatiche}
}
\newcommand{\computerSkills}[2]{%
  \ecvblueitem{%
    \computerSkillsString%
  }{%
    \ifEngIta{#1}{#2}%
  }%
}%

\ifEngIta{
  \newcommand{\otherSkillsString}{Other skills}
}{
  \newcommand{\otherSkillsString}{Altre capacità}
}
\newcommand{\otherSkills}[2]{%
  \ecvblueitem{%
    \otherSkillsString%
  }{%
    \ifEngIta{#1}{#2}%
  }%
}%

\ifEngIta{
  \newcommand{\drivingLicenceString}{Driving licence}
}{
  \newcommand{\drivingLicenceString}{Patente}
}
\newcommand{\drivingLicence}[2]{%
  \ecvblueitem{%
    \drivingLicenceString%
  }{%
    \ifEngIta{#1}{#2}%
  }%
}%

\ifEngIta{
  \newcommand{\additionalInfoString}{Additional information}
}{
\newcommand{\additionalInfoString}{Ulteriori informazioni}
}
\newcommand{\additionalInfo}{%
  \ecvsection{\additionalInfoString}%
}%

\ifEngIta{
  \newcommand{\referencesString}{References}
}{
  \newcommand{\referencesString}{Referenze}
}
\newcommand{\references}[2]{%
  \ecvblueitem{%
    \referencesString%
  }{%
    \begin{ecvitemize}\ifEngIta{#1}{#2}\end{ecvitemize}%
  }%
}%
\newcommand{\addReference}[1]{%
  \addListItem{#1}%
}%

\ifEngIta{
  \newcommand{\otherProjectsString}{Other projects}
}{
  \newcommand{\otherProjectsString}{Altri progetti}
}
\newcommand{\otherProjects}[1]{%
  \ifProjects{\ecvblueitem{%
    \otherProjectsString%
  }{%
    \begin{ecvitemize}#1\end{ecvitemize}%
  }}%
}%

\ifEngIta{
  \newcommand{\publicationsString}{Publications}
}{
\newcommand{\publicationsString}{Pubblicazioni}
}
\newcommand{\addPublications}[1]{%
  \ifPublications{%
  	\bibliographystyle{plain}
    \nobibliography{publications}
    \ecvblueitem{%
      \publicationsString%
    }{%
      \begin{ecvitemize}#1\end{ecvitemize}%
    }%
  }%
}%
\newcommand{\addPublication}[1]{%
  \item \bibentry{#1}%
}%
